<!DOCTYPE HTML>

<html>
<head>
    <script type="text/javascript" src="//vk.com/js/api/openapi.js?147"></script>
    <script type="text/javascript">
        VK.init({apiId: 6180474});
    </script>
    Log in (RR)
</head>
<body id="body">
    <div> is_auth : {{ is_auth }} </div>
    <div id="vk_auth"></div>
    <form hidden="hidden" name="person" action="https://rubenruben.pythonanywhere.com" method="post">
        {% csrf_token %}
        <input id="uid" type="text" name="uid" value="0">
        <input id="first_name" type="text" name="first_name" value="None">
        <input id="last_name" type="text" name="last_name" value="None">
        <input id="submit" type="submit" value="Enter">
    </form>
    <script type="text/javascript">
        VK.Widgets.Auth("vk_auth", {onAuth: function(data) {
            document.getElementById('uid').value=data["uid"];
            document.getElementById('first_name').value=data["first_name"];
            document.getElementById('last_name').value=data["last_name"];
            VK.Api.call('friends.get', {count: 3, fields: true}, function(r) {
                if(r.response) {
                    var body = document.getElementById('body')
                    var div = document.createElement('div');
                    div.innerHTML = "Друзья:\n" + r.response[0]["first_name"] + r.response[0]["last_name"];
                    body.appendChild(div)
                    var div = document.createElement('div');
                    div.innerHTML = "Друзья:\n" + r.response[1]["first_name"] + r.response[1]["last_name"];
                    body.appendChild(div)
                    var div = document.createElement('div');
                    div.innerHTML = "Друзья:\n" + r.response[2]["first_name"] + r.response[2]["last_name"];
                    body.appendChild(div)
                }
            });
        } });
    </script>
</body>
